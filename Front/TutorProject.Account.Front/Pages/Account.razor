@page "/account"
@using TutorProject.Account.Front.Models
@using TutorProject.Account.Front.Services
@inject NavigationManager NavigationManager
@inject HttpService _HttpService
@inject AuthorizationService _authorizationService;

<PageTitle>Личный кабинет</PageTitle>


<!-- Generated by ai2html v0.111.0 - 2022-06-26 18:14 -->
<!-- ai file: личный кабинет.ai -->
<style media="screen,print">
	#g-_-_-box ,
	#g-_-_-box .g-artboard {
		margin:0 auto;
	}
	#g-_-_-box p {
		margin:0;
	}
	#g-_-_-box .g-aiAbs {
		position:absolute;
	}
	#g-_-_-box .g-aiImg {
		position:absolute;
		top:0;
		display:block;
		width:100% !important;
	}
	#g-_-_-box .g-aiSymbol {
		position: absolute;
		box-sizing: border-box;
	}
	#g-_-_-box .g-aiPointText p { white-space: nowrap; }
	#g-_-_-Artboard_1 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_1 p {
		font-weight:700;
		line-height:43px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:21px;
		text-align:left;
		color:rgb(77,77,77);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_1 .g-pstyle0 {
		line-height:76px;
		height:76px;
		font-size:90px;
		text-align:center;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_1 .g-pstyle1 {
		line-height:42px;
		height:42px;
		font-size:24px;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_1 .g-pstyle2 {
		line-height:42px;
		height:42px;
		font-size:24px;
	}
	#g-_-_-Artboard_1 .g-pstyle3 {
		height:43px;
		opacity:0.41;
		font-size:25px;
	}
	#g-_-_-Artboard_1 .g-pstyle4 {
		height:43px;
		font-size:25px;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_1 .g-pstyle5 {
		height:43px;
	}
	#g-_-_-Artboard_1 .g-cstyle0 {
		color:rgb(255,115,92);
	}
	#g-_-_-Artboard_2 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_2 p {
		font-weight:700;
		line-height:43px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:21px;
		text-align:left;
		color:rgb(77,77,77);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_2 .g-pstyle0 {
		line-height:76px;
		height:76px;
		font-size:90px;
		text-align:center;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_2 .g-pstyle1 {
		line-height:42px;
		height:42px;
		font-size:24px;
	}
	#g-_-_-Artboard_2 .g-pstyle2 {
		line-height:42px;
		height:42px;
		font-size:24px;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_2 .g-pstyle3 {
		height:43px;
		opacity:0.41;
		font-size:25px;
	}
	#g-_-_-Artboard_2 .g-pstyle4 {
		height:43px;
		font-size:25px;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_2 .g-pstyle5 {
		height:43px;
	}
	#g-_-_-Artboard_2 .g-cstyle0 {
		color:rgb(255,115,92);
	}
	#g-_-_-Artboard_3 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_3 p {
		font-weight:700;
		line-height:43px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:21px;
		text-align:left;
		color:rgb(240,240,240);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_3 .g-pstyle0 {
		line-height:82px;
		height:82px;
		font-size:30px;
	}
	#g-_-_-Artboard_3 .g-pstyle1 {
		line-height:82px;
		height:82px;
		font-size:62px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_3 .g-pstyle2 {
		height:43px;
	}
	#g-_-_-Artboard_3 .g-pstyle3 {
		height:43px;
		opacity:0.41;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_4 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_4 p {
		font-weight:700;
		line-height:31px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:18px;
		text-align:left;
		color:rgb(240,240,240);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_4 .g-pstyle0 {
		line-height:82px;
		height:82px;
		font-size:30px;
	}
	#g-_-_-Artboard_4 .g-pstyle1 {
		line-height:82px;
		height:82px;
		font-size:62px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_4 .g-pstyle2 {
		line-height:43px;
		height:43px;
		font-size:21px;
	}
	#g-_-_-Artboard_4 .g-pstyle3 {
		line-height:43px;
		height:43px;
		opacity:0.41;
		font-size:21px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_4 .g-pstyle4 {
		height:31px;
	}
	#g-_-_-Artboard_4 .g-pstyle5 {
		height:31px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_5 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_5 p {
		font-weight:700;
		line-height:43px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:21px;
		text-align:left;
		color:rgb(240,240,240);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_5 .g-pstyle0 {
		line-height:82px;
		height:82px;
		font-size:30px;
	}
	#g-_-_-Artboard_5 .g-pstyle1 {
		line-height:82px;
		height:82px;
		font-size:62px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_5 .g-pstyle2 {
		height:43px;
	}
	#g-_-_-Artboard_5 .g-pstyle3 {
		line-height:42px;
		height:42px;
		font-size:24px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_6 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_6 p {
		font-weight:700;
		line-height:43px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:21px;
		text-align:left;
		color:rgb(240,240,240);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_6 .g-pstyle0 {
		line-height:82px;
		height:82px;
		font-size:30px;
	}
	#g-_-_-Artboard_6 .g-pstyle1 {
		line-height:82px;
		height:82px;
		font-size:62px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_6 .g-pstyle2 {
		height:43px;
	}

</style>
@if (_authData?.UserType == "Client")
{
	<div id="g-_-_-box" class="ai2html">
	<!-- Artboard: Artboard_3 -->
	<div id="g-_-_-Artboard_3" class="g-artboard" style="max-width: 1600px;max-height: 800px" data-aspect-ratio="2" data-min-width="0">
		<div style="padding: 0 0 50% 0;"></div>
		<img id="g-_-_-Artboard_3-img" class="g-_-_-Artboard_3-img g-aiImg" alt="" src="https://i.ibb.co/m024BhV/Artboard-3.png"/>
		<div id="g-ai2-1" class="g-_ g-aiAbs g-aiPointText" style="top:7.5963%;margin-top:-42.8px;left:1.4966%;width:272px;">
			<p class="g-pstyle0">TUTORSERVICE</p>
		</div>
		<div id="g-ai2-2" class="g-_ g-aiAbs g-aiPointText" style="top:17.3322%;margin-top:-44.7px;left:22.183%;width:613px;">
			<p class="g-pstyle1">Личный кабинет</p>
		</div>
		<div id="g-ai2-3" class="g-_ g-aiAbs g-aiPointText" style="top:18.9634%;margin-top:-22.7px;left:4.3575%;width:215px;">
			<p class="g-pstyle2">Личный кабинет</p>
		</div>
		<div id="g-ai2-4" class="g-_ g-aiAbs g-aiPointText" style="top:25.9634%;margin-top:-22.7px;left:23.629%;width:70px;">
			<p class="g-pstyle3">@Name</p>
		</div>
		<div id="g-ai2-5" class="g-_ g-aiAbs g-aiPointText" style="top:26.0884%;margin-top:-22.7px;left:4.3575%;width:80px;">
			<p class="g-pstyle2">
				<a href="/chats" style="text-decoration: none; color: white" class="g-pstyle2">Чаты</a>
			</p>
		</div>
		<div id="g-ai2-6" class="g-_ g-aiAbs g-aiPointText" style="top:33.7134%;margin-top:-22.7px;left:4.3575%;width:234px;">
			<p class="g-pstyle2">
			<a style="text-decoration: none; color: white" href="@SearcherLink" class="g-pstyle2">Найти репетитора</a>
			</p>
		</div>
		<div id="g-ai2-7" class="g-_ g-aiAbs g-aiPointText" style="top:33.9634%;margin-top:-22.7px;left:23.629%;width:120px;">
			<p class="g-pstyle3">@Description</p>
		</div>
	</div>
	</div>
}

	@if (_authData?.UserType == "Tutor")
	{
		<div id="g-_-_-box" class="ai2html">
			<!-- Artboard: Artboard_4 -->
			<div id="g-_-_-Artboard_4" class="g-artboard" style="max-width: 1600px;max-height: 800px" data-aspect-ratio="2" data-min-width="0">
				<div style="padding: 0 0 50% 0;"></div>
				<img id="g-_-_-Artboard_4-img" class="g-_-_-Artboard_4-img g-aiImg" alt="" src="https://i.ibb.co/K7SG6cJ/Artboard-4.png"/>
				<div id="g-ai3-1" class="g-_ g-aiAbs g-aiPointText" style="top:7.5963%;margin-top:-42.8px;left:1.4966%;width:272px;">
					<p class="g-pstyle0">TUTORSERVICE</p>
				</div>
				<div id="g-ai3-2" class="g-_ g-aiAbs g-aiPointText" style="top:17.3322%;margin-top:-44.7px;left:22.183%;width:613px;">
					<p class="g-pstyle1">Личный кабинет</p>
				</div>
				<div id="g-ai3-3" class="g-_ g-aiAbs g-aiPointText" style="top:18.9634%;margin-top:-22.7px;left:4.3575%;width:215px;">
					<p class="g-pstyle2">Личный кабинет</p>
				</div>
				<div id="g-ai3-4" class="g-_ g-aiAbs g-aiPointText" style="top:25.9634%;margin-top:-22.7px;left:23.629%;width:70px;">
					<p class="g-pstyle3">@Name</p>
				</div>
				<div id="g-ai3-5" class="g-_ g-aiAbs g-aiPointText" style="top:26.0884%;margin-top:-22.7px;left:4.3575%;width:80px;">
			<a style="text-decoration: none; color: white" href="/chats" class="g-pstyle2">Чаты</a>
				</div>
				<div id="g-ai3-6" class="g-_ g-aiAbs g-aiPointText" style="top:33.0496%;margin-top:-16.4px;left:44.1867%;width:85px;">
					<p class="g-pstyle4">У себя</p>
				</div>
				<div id="g-ai3-7" class="g-_ g-aiAbs g-aiPointText" style="top:33.0496%;margin-top:-16.4px;left:44.1867%;width:85px;">
					<p class="g-pstyle5">У себя</p>
				</div>
				<div id="g-ai3-8" class="g-_ g-aiAbs g-aiPointText" style="top:33.0496%;margin-top:-16.4px;left:23.2085%;width:98px;">
					<p class="g-pstyle4">Онлайн</p>
				</div>
				<div id="g-ai3-9" class="g-_ g-aiAbs g-aiPointText" style="top:33.0496%;margin-top:-16.4px;left:32.9429%;width:121px;">
					<p class="g-pstyle4">У ученика</p>
				</div>
				<div id="g-ai3-10" class="g-_ g-aiAbs g-aiPointText" style="top:33.0496%;margin-top:-16.4px;left:32.9429%;width:121px;">
					<p class="g-pstyle5">У ученика</p>
				</div>
				<div id="g-ai3-11" class="g-_ g-aiAbs g-aiPointText" style="top:33.1746%;margin-top:-16.4px;left:53.2808%;width:142px;">
					<p class="g-pstyle4">Смешанный</p>
				</div>
				<div id="g-ai3-12" class="g-_ g-aiAbs g-aiPointText" style="top:33.1746%;margin-top:-16.4px;left:53.2808%;width:142px;">
					<p class="g-pstyle5">Смешанный</p>
				</div>
				<div id="g-ai3-13" class="g-_ g-aiAbs g-aiPointText" style="top:41.3384%;margin-top:-22.7px;left:23.629%;width:145px;">
					<p class="g-pstyle3">Цена в час</p>
				</div>
				<div id="g-ai3-14" class="g-_ g-aiAbs g-aiPointText" style="top:50.2134%;margin-top:-22.7px;left:23.629%;width:120px;">
					<p class="g-pstyle3">@Description</p>
				</div>
			</div>
		</div>
	}
<button class="btn" onclick="@LogOut">Выйти</button>
@code {
	private string SearcherLink => $"http://localhost:7000/search/{_authData?.Token}";
    private string? Name { get; set; }
    private string? Price { get; set; }
    private string? IntervalClass { get; set; }
    private string? WorkFormat { get; set; }
    private string? Description { get; set; }

    private AuthorizationData _authData;

    private async Task GetTutor()
    {
        var response = await _HttpService.GetAsync<Tutor>($"/api/tutors?token={_authData.Token}");

        var user = response.ResponseDto;
        Name = user?.Name;
        Description = user?.Description ?? "пусто";
        Price = user?.PricePerHour == null ? Convert.ToString(user?.PricePerHour) : "пусто";
        IntervalClass = (user?.PupilMinClass == null || user?.PupilMaxClass == null) ?
            Convert.ToString(user?.PupilMinClass) + "-" + Convert.ToString(user?.PupilMaxClass) : "пусто";
        WorkFormat = user?.WorkFormat switch
        {
            Common.Models.WorkFormat.Online => "Онлайн",
            Common.Models.WorkFormat.ClientHome => "у Клиента",
            Common.Models.WorkFormat.TutorHome => "У Репетитора",
            Common.Models.WorkFormat.Empty => "пусто",
            _ => throw new ArgumentOutOfRangeException()
            };
    }
    
    private async Task GetClient()
    {
        var result = await _HttpService.GetAsync<Client>($"/api/clients?token={_authData.Token}");
        Name = result.ResponseDto.Name;
    }

    private async Task LogOut()
    {
        await _authorizationService.CancelAuthorization();
        NavigationManager.NavigateTo("Login");
    }

    protected override async Task OnInitializedAsync()
    {
        var authData = await _authorizationService.GetAuthData();
        if (authData is null)
            NavigationManager.NavigateTo("Login");

        _authData = authData!;
        
        if (authData!.UserType == "Client")
            await GetClient();
        else
            await GetTutor();
    }
}