@page "/chats"
@using TutorProject.Account.Front.Models
@using TutorProject.Account.Front.Services
@inject NavigationManager NavigationManager
@inject HttpService _httpService
@inject AuthorizationService _authorizationService
<PageTitle>Chats</PageTitle>

<style media="screen,print">
	#g-_-_-box ,
	#g-_-_-box .g-artboard {
		margin:0 auto;
	}
	#g-_-_-box p {
		margin:0;
	}
	#g-_-_-box .g-aiAbs {
		position:absolute;
	}
	#g-_-_-box .g-aiImg {
		position:absolute;
		top:0;
		display:block;
		width:100% !important;
	}
	#g-_-_-box .g-aiSymbol {
		position: absolute;
		box-sizing: border-box;
	}
	#g-_-_-box .g-aiPointText p { white-space: nowrap; }
	#g-_-_-Artboard_1 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_1 p {
		font-weight:700;
		line-height:43px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:21px;
		text-align:left;
		color:rgb(77,77,77);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_1 .g-pstyle0 {
		line-height:76px;
		height:76px;
		font-size:90px;
		text-align:center;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_1 .g-pstyle1 {
		line-height:42px;
		height:42px;
		font-size:24px;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_1 .g-pstyle2 {
		line-height:42px;
		height:42px;
		font-size:24px;
	}
	#g-_-_-Artboard_1 .g-pstyle3 {
		height:43px;
		opacity:0.41;
		font-size:25px;
	}
	#g-_-_-Artboard_1 .g-pstyle4 {
		height:43px;
		font-size:25px;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_1 .g-pstyle5 {
		height:43px;
	}
	#g-_-_-Artboard_1 .g-cstyle0 {
		color:rgb(255,115,92);
	}
	#g-_-_-Artboard_2 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_2 p {
		font-weight:700;
		line-height:43px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:21px;
		text-align:left;
		color:rgb(77,77,77);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_2 .g-pstyle0 {
		line-height:76px;
		height:76px;
		font-size:90px;
		text-align:center;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_2 .g-pstyle1 {
		line-height:42px;
		height:42px;
		font-size:24px;
	}
	#g-_-_-Artboard_2 .g-pstyle2 {
		line-height:42px;
		height:42px;
		font-size:24px;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_2 .g-pstyle3 {
		height:43px;
		opacity:0.41;
		font-size:25px;
	}
	#g-_-_-Artboard_2 .g-pstyle4 {
		height:43px;
		font-size:25px;
		color:rgb(240,240,240);
	}
	#g-_-_-Artboard_2 .g-pstyle5 {
		height:43px;
	}
	#g-_-_-Artboard_2 .g-cstyle0 {
		color:rgb(255,115,92);
	}
	#g-_-_-Artboard_3 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_3 p {
		font-weight:700;
		line-height:43px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:21px;
		text-align:left;
		color:rgb(240,240,240);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_3 .g-pstyle0 {
		line-height:82px;
		height:82px;
		font-size:30px;
	}
	#g-_-_-Artboard_3 .g-pstyle1 {
		line-height:82px;
		height:82px;
		font-size:62px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_3 .g-pstyle2 {
		height:43px;
	}
	#g-_-_-Artboard_3 .g-pstyle3 {
		height:43px;
		opacity:0.41;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_4 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_4 p {
		font-weight:700;
		line-height:31px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:18px;
		text-align:left;
		color:rgb(240,240,240);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_4 .g-pstyle0 {
		line-height:82px;
		height:82px;
		font-size:30px;
	}
	#g-_-_-Artboard_4 .g-pstyle1 {
		line-height:82px;
		height:82px;
		font-size:62px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_4 .g-pstyle2 {
		line-height:43px;
		height:43px;
		font-size:21px;
	}
	#g-_-_-Artboard_4 .g-pstyle3 {
		line-height:43px;
		height:43px;
		opacity:0.41;
		font-size:21px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_4 .g-pstyle4 {
		height:31px;
	}
	#g-_-_-Artboard_4 .g-pstyle5 {
		height:31px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_5 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_5 p {
		font-weight:700;
		line-height:43px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:21px;
		text-align:left;
		color:rgb(240,240,240);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_5 .g-pstyle0 {
		line-height:82px;
		height:82px;
		font-size:30px;
	}
	#g-_-_-Artboard_5 .g-pstyle1 {
		line-height:82px;
		height:82px;
		font-size:62px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_5 .g-pstyle2 {
		height:43px;
	}
	#g-_-_-Artboard_5 .g-pstyle3 {
		line-height:42px;
		height:42px;
		font-size:24px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_6 {
		position:relative;
		overflow:hidden;
	}
	#g-_-_-Artboard_6 p {
		font-weight:700;
		line-height:43px;
		height:auto;
		opacity:1;
		letter-spacing:0.014em;
		font-size:21px;
		text-align:left;
		color:rgb(240,240,240);
		text-transform:none;
		padding-bottom:0;
		padding-top:0;
		mix-blend-mode:normal;
		font-style:normal;
		position:static;
	}
	#g-_-_-Artboard_6 .g-pstyle0 {
		line-height:82px;
		height:82px;
		font-size:30px;
	}
	#g-_-_-Artboard_6 .g-pstyle1 {
		line-height:82px;
		height:82px;
		font-size:62px;
		color:rgb(77,77,77);
	}
	#g-_-_-Artboard_6 .g-pstyle2 {
		height:43px;
	}

</style>

@if (_chats == null)
{
    <p><em>Loading...</em></p>
}
else{
<div id="g-_-_-box" class="ai2html">

	<!-- Artboard: Artboard_5 -->
	<div id="g-_-_-Artboard_5" class="g-artboard" style="max-width: 1600px;max-height: 800px" data-aspect-ratio="2" data-min-width="0">
		<div style="padding: 0 0 50% 0;"></div>
		@if (_authData?.UserType == "Client")
		{
			<img id="g-_-_-Artboard_5-img" class="g-_-_-Artboard_5-img g-aiImg" alt="" src="https://i.ibb.co/GCT2dNn/Artboard-5.png"/>
		}
		@if (_authData?.UserType == "Tutor")
        		{
        			<img id="g-_-_-Artboard_5-img" class="g-_-_-Artboard_5-img g-aiImg" alt="" src="https://i.ibb.co/BV01wKt/Tutor-Account.png"/>
        		}
		<div id="g-ai4-1" class="g-_ g-aiAbs g-aiPointText" style="top:7.5963%;margin-top:-42.8px;left:1.4966%;width:272px;">
            <p class="g-pstyle0"><a href="/" style="text-decoration: none; color: white">TUTORSERVICE</a></p>
		</div>
		<div id="g-ai4-2" class="g-_ g-aiAbs g-aiPointText" style="top:17.3322%;margin-top:-44.7px;left:22.183%;width:200px;">
			<p class="g-pstyle1">Чаты</p>
		</div>
		<div id="g-ai4-3" class="g-_ g-aiAbs g-aiPointText" style="top:18.9634%;margin-top:-22.7px;left:4.3575%;width:215px;">
			<p class="g-pstyle2">
				<a href="/Account" style="text-decoration: none; color: white" class="g-pstyle2">Личный кабинет</a>
			</p>
		</div>
		<div id="g-ai4-4" class="g-_ g-aiAbs g-aiPointText" style="top:25.5654%;margin-top:-22.5px;left:23.4773%;width:163px;">
			@if (_authData!.UserType == "Client")
			{
				<p class="g-pstyle3">Репетитор</p>	
			}
			else
			{
				<p class="g-pstyle3">Ученик</p>	
			}
			<table style="margin-top:20px; margin-left:20px">
				<tbody>
				@if (_authData?.UserType == "Tutor")
				{
					@foreach (var chat in _chats)
					{
						<tr>
							<td>@chat.ClientName</td>
						</tr>
					}
				}
				@if (_authData?.UserType == "Client")
				{
					@foreach (var chat in _chats)
					{
						<tr>
							<td>@chat.TutorName</td>
						</tr>
					}
				}
				</tbody>
			</table>
		</div>
		<div id="g-ai4-5" class="g-_ g-aiAbs g-aiPointText" style="top:25.5654%;margin-top:-22.5px;left:50.0345%;width:120px;">
		<p class="g-pstyle3">Ссылка</p>
			<table style="margin-top:20px; margin-left:20px">
        		<tbody>
        		@foreach (var chat in _chats)
        		{
        		    <tr>
        		        <a class="g-aiPointText" style="text-decoration: none; color: black" href="http://localhost:9000/chat/@chat.ChatId/@_authData!.Token">К чату</a>
        		    </tr>
        		}
				</tbody>
        	</table>
		</div>
		<div id="g-ai4-6" class="g-_ g-aiAbs g-aiPointText" style="top:26.0884%;margin-top:-22.7px;left:4.3575%;width:80px;">
			<p class="g-pstyle2">Чаты</p>
		</div>
		@if (_authData?.UserType == "Client")
		{
			<div id="g-ai4-7" class="g-_ g-aiAbs g-aiPointText" style="top:33.7134%;margin-top:-22.7px;left:4.3575%;width:234px;">
				<p class="g-pstyle2">
				<a href="@SearcherLink" style="text-decoration: none; color: white" class="g-pstyle2">Найти репетитора</a>
				</p>
			</div>
		}
	</div>
</div>
}

@code {
	private string SearcherLink => $"http://localhost:7000/search/{_authData?.Token}";
    private List<Chat>? _chats;
    private AuthorizationData _authData;

    private async Task GetChats()
    {
        var result = await _httpService.GetAsync<List<Chat>>($"/api/chats?token={_authData.Token}");
        _chats = result.ResponseDto;
    }

    protected override async Task OnInitializedAsync()
    {
        var authData = await _authorizationService.GetAuthData();
        if (authData is null)
            NavigationManager.NavigateTo("Login");

        _authData = authData!;
        await GetChats();
    }
}